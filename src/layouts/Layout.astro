---
import Head from "../components/Head.astro";
import "../styles/global.css";
interface Props {
  title: string;
  bodyClass?: string;
}

const { title, bodyClass = "", ...bodyProps } = Astro.props;
---

<html lang="en">
  <Head title={title} />
  <body
    {...bodyProps}
    class={`${bodyClass} mx-auto flex max-w-[1440px] flex-col scroll-smooth bg-bg px-8 font-inter text-primary transition-colors`}
  >
    <main>
      <slot />
    </main>

    <script>
      import { gsap } from "gsap";
      import { ScrollTrigger } from "gsap/ScrollTrigger";

      gsap.registerPlugin(ScrollTrigger);

      const prefersReducedMotion = window.matchMedia(
        "(prefers-reduced-motion: reduce)",
      ).matches;

      if (!prefersReducedMotion) {
        const animateElements =
          document.querySelectorAll<HTMLElement>("[data-animate]");

        animateElements.forEach((element) => {
          if (element.closest("[data-animate-group]")) {
            return;
          }

          const type = element.dataset.animate ?? "fade-up";
          const delay = Number.parseFloat(element.dataset.animateDelay ?? "0");
          const offset = Number.parseFloat(
            element.dataset.animateOffset ?? "24",
          );
          const start = element.dataset.animateStart ?? "top 85%";
          const from = {
            autoAlpha: 0,
            x:
              type === "fade-left"
                ? -offset
                : type === "fade-right"
                  ? offset
                  : 0,
            y: type === "fade-up" ? offset : 0,
          };

          gsap.from(element, {
            ...from,
            duration: 0.8,
            ease: "power2.out",
            delay,
            clearProps: "transform",
            scrollTrigger: {
              trigger: element,
              start,
              toggleActions: "play none none none",
            },
          });
        });

        document
          .querySelectorAll<HTMLElement>("[data-animate-group]")
          .forEach((group) => {
            const items = group.querySelectorAll<HTMLElement>(
              "[data-animate-item]",
            );

            if (!items.length) {
              return;
            }

            const groupOffset = Number.parseFloat(
              group.dataset.animateOffset ?? "18",
            );
            const groupStart = group.dataset.animateStart ?? "top 80%";

            gsap.from(items, {
              autoAlpha: 0,
              y: groupOffset,
              duration: 0.7,
              ease: "power2.out",
              stagger: 0.08,
              clearProps: "transform",
              scrollTrigger: {
                trigger: group,
                start: groupStart,
                toggleActions: "play none none none",
              },
            });
          });

        window.addEventListener("load", () => {
          ScrollTrigger.refresh();
        });
      }
    </script>
  </body>
</html>
