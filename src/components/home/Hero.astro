---
import Menu from "../menu/Menu";
import { LuArrowDown } from "react-icons/lu";
---

<section data-hero id="hero" class="mb-40 flex min-h-screen flex-col py-8">
  <header class="flex items-center justify-end gap-2">
    <div class="text-end">
      <h2 class="text-primary">SOFTWARE ENGINEER</h2>
      <h3 class="text-sm text-secondary">Rogers, AR</h3>
    </div>
    <Menu client:only />
  </header>
  <div class="my-auto flex flex-col gap-8 py-8">
    <h2>INDEX</h2>
    <h1 data-hero-title class="text-[12rem] font-black">
      TRISTAN<br />KENNEDY
    </h1>
    <div class="flex gap-8">
      <span data-hero-accent aria-hidden class="h-12 w-12 bg-accent"></span>
      <nav data-hero-nav class="h2">
        <ul>
          <li class="transition-transform hover:translate-x-2">
            <a href="#about" class="transition-colors hover:text-accent"
              >01/ ABOUT ME</a
            >
          </li>
          <li class="transition-transform hover:translate-x-2">
            <a href="#projects" class="transition-colors hover:text-accent"
              >02/ PROJECTS</a
            >
          </li>
          <li class="transition-transform hover:translate-x-2">
            <a href="#posts" class="transition-colors hover:text-accent"
              >03/ POSTS</a
            >
          </li>
          <li class="transition-transform hover:translate-x-2">
            <a href="#experiments" class="transition-colors hover:text-accent"
              >04/ EXPERIMENTS</a
            >
          </li>
          <li class="transition-transform hover:translate-x-2">
            <a href="#contact" class="transition-colors hover:text-accent"
              >05/ CONTACT</a
            >
          </li>
        </ul>
      </nav>
    </div>
  </div>
  <footer class="flex justify-between">
    <h2>Â© 2025</h2>
    <div class="h2 flex items-center gap-2">
      <LuArrowDown />
      <h2>SCROLL</h2>
    </div>
  </footer>
</section>

<script>
  import gsap from "gsap";

  function runIntro() {
    if (window.matchMedia("(prefers-reduced-motion: reduce)").matches) {
      document.getElementById("intro-overlay")?.remove();
      return;
    }

    const overlay = document.getElementById("intro-overlay");
    const square = document.querySelector("[data-hero-accent]");
    const title = document.querySelector("[data-hero-title]");
    const nav = document.querySelector("[data-hero-nav]");

    if (!overlay || !square) return;

    // Lock scroll
    document.documentElement.classList.add("overflow-hidden");
    document.body.classList.add("overflow-hidden");

    // Measure where the square ends up
    const squareRect = square.getBoundingClientRect();

    const tl = gsap.timeline({
      defaults: { ease: "power4.inOut" },
      onComplete() {
        overlay.remove();
        document.documentElement.classList.remove("overflow-hidden");
        document.body.classList.remove("overflow-hidden");
      },
    });

    // Initial state: overlay fills screen
    gsap.set(overlay, {
      clipPath: "inset(0% 0% 0% 0%)",
    });

    // Animate overlay collapsing INTO the square
    tl.to(overlay, {
      clipPath: `inset(
        ${squareRect.top}px 
        ${window.innerWidth - squareRect.right}px 
        ${window.innerHeight - squareRect.bottom}px 
        ${squareRect.left}px
      )`,
      duration: 1.1,
    });

    // Reveal hero content after collapse begins
    tl.fromTo(
      [title, nav],
      { y: 16, opacity: 0 },
      { y: 0, opacity: 1, stagger: 0.06, duration: 0.6 },
      "-=0.4",
    );
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", runIntro);
  } else {
    runIntro();
  }
</script>
